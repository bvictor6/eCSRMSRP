<!DOCTYPE html>
<!--[if IE 9]>         <html class="ie9 no-focus"> <![endif]-->
<!--[if gt IE 9]><!--> 
<html class="no-focus" xmlns:th="http://www.thymeleaf.org" lang="en"> 
<!--<![endif]-->
    <head>
        <meta charset="utf-8">

 		<!--  -->
        <meta th:name="_csrf" th:content="${_csrf.token}"/>
		<meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
	    <!-- ... -->
	    
        <title>Supplier Registration Portal</title>

        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0">

        <!-- Icons -->
        <!-- The following icons can be replaced with your own, they are used by desktop and mobile browsers -->
        <link rel="shortcut icon" href="../assets/img/favicons/favicon.png">

        <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-16x16.png" sizes="16x16">
        <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-160x160.png" sizes="160x160">
        <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-192x192.png" sizes="192x192">

        <link rel="apple-touch-icon" sizes="57x57" href="../assets/img/favicons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="../assets/img/favicons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="../assets/img/favicons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/favicons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="../assets/img/favicons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="../assets/img/favicons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="../assets/img/favicons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="../assets/img/favicons/apple-touch-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="../assets/img/favicons/apple-touch-icon-180x180.png">
        <!-- END Icons -->

        <!-- Stylesheets -->
        <!-- Web fonts -->
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400italic,600,700%7COpen+Sans:300,400,400italic,600,700">
		<!--Start fontawesome css-->
		<link href="../assets/css/fontawesome.css" rel="stylesheet" />
		<link href="../assets/css/brands.css" rel="stylesheet" />
		<link href="../assets/css/solid.css" rel="stylesheet" />
		<!--End fontawesome css-->
		<link rel="stylesheet" href="../assets/js/plugins/select2/select2.min.css">
		<link rel="stylesheet" href="../assets/js/plugins/select2/select2-bootstrap.css">
        <!-- OneUI CSS framework -->
        <link rel="stylesheet" id="css-main" href="../assets/css/oneui.css">

        <!-- You can include a specific file from css/themes/ folder to alter the default color theme of the template. eg: -->
        <link rel="stylesheet" id="css-theme" href="../assets/css/themes/city.min.css"> 
        <!-- END Stylesheets -->
		<style> 
		    .container-fluid { 
		        background-color: #ffffff; 
		        border-radius: 8px; 
		        border: 1px solid lightgrey; 
		        padding: 16px; 
		        -webkit-box-shadow: 0px 0px 12px 2px rgba(0, 0, 0, 0.75); 
		        -moz-box-shadow: 0px 0px 12px 2px rgba(0, 0, 0, 0.75); 
		        box-shadow: 0px 0px 12px 2px rgba(0, 0, 0, 0.75); 
		    } 
		      
		    .input-group { 
		        width: 80%; 
		        height: auto; 
		        padding: 4px; 
		    } 
		      
		    .progress { 
		        height: 4px; 
		    } 
		      
		    .progress-bar { 
		        background-color: green; 
		    } 
		</style> 
    </head>
    <body>
        <!-- Page Container -->
        <div id="page-container">
            <!-- Main Container -->
            <main id="main-container">
                <!-- Page Header -->
                <!--div class="content bg-image overflow-hidden" style="background-color: #09c;"-->
				<div class="bg-image overflow-hidden bg-default-light">
					<div class="col-lg-2 col-lg-offset-5 push-10 push-0-t">
						<a href="/">
							<img 
								src='../assets/images/botswana_logo_web.png'
								height="150"
								alt=""
							/>
						</a>						
                    </div>
                </div>
                <!-- END Page Header -->				
				               
                <!-- Page Content -->
                <div class="content">                	                  
					<!-- Wizards with Validation -->                    
                    <div class="row">
						<div class="col-lg-2">&nbsp;</div>
                        <div class="col-lg-8 col-sm-12">							
							<div class="push-10">
								<h2 class="content-heading">Welcome to the Supplier Self-Registration Page</h2>
								<small class="text-muted">Welcome to the Supplier Self Registration Portal. this Portal serves as the initial point of entry for future vendors to do business.</small>
							</div>
							
                            <!-- Validation Wizard (.js-wizard-validation class is initialized in js/pages/base_forms_wizard.js) -->
                            <!-- For more examples you can check out http://vadimg.com/twitter-bootstrap-wizard-example/ -->
                            <div class="js-wizard-validation block">								
                                <!-- Step Tabs -->
                                <ul class="nav nav-tabs nav-tabs-alt nav-justified">
                                    <li class="active">
                                        <a class="inactive" href="#validation-step1" data-toggle="tab">1. Company Details</a>
                                    </li>
                                    <li>
                                        <a class="inactive" href="#validation-step2" data-toggle="tab">2. Personal Details</a>
                                    </li>
                                    <li>
                                        <a class="inactive" href="#validation-step3" data-toggle="tab">3. Account Details</a>
                                    </li>
                                </ul>
                                <!-- END Step Tabs -->
								
								<!-- Alert -->
								<div class="push-30">
									<code class="col-sm-12 text-xl" id="alert1" style="display:none !important;">
										<small>No supplier was found matching the provided name, Please try again!</small>
		                            </code>
								</div>                            
	                            <!-- End Alert -->

                                <!-- Form -->
                                <!-- jQuery Validation (.js-form2 class is initialized in js/pages/base_forms_wizard.js) -->
                                <!-- For more examples you can check out https://github.com/jzaefferer/jquery-validation -->
                                <form class="js-form2 form-horizontal" action="#" th:action="@{/profile/save}" th:object="${user}" method="post">
									<input type="hidden" id="ecsrmId" name="escrmId" th:field="*{ecsrmId}">
									<input type="hidden" id="code" name="code" th:field="*{code}">
									<!-- Steps Content -->
                                    <div class="block-content tab-content">
                                        <!-- Step 1 -->
                                        <div class="tab-pane fade fade-right in push-30-t push-50 active" id="validation-step1">
                                            <div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" type="text" id="name" name="name" th:field="*{name}" placeholder="Supplier Name">
                                                        <label for="name">Supplier Name <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>	
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{physicalAddress}" type="text" id="physicalAddress" name="physicalAddress" placeholder="Physical Address">
                                                        <label for="physicalAddress">Physical Address <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>											
                                            </div>											
											<div class="form-group">                                                
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{contractNo}" type="text" id="contractNo" name="contractNo" placeholder="Contract Number">
                                                        <label for="contractNo">Contract No. <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{tenderNo}" type="text" id="tenderNo" name="tenderNo" placeholder="Tender No.">
                                                        <label for="tenderNo">Tender No. <span class="text-danger"></span></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">                                                
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{email}" type="text" id="email" name="email" placeholder="Email Address">
                                                        <label for="email">Email Address <span class="text-danger"></span></label>
                                                    </div>
                                                </div>	
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{fax}" type="text" id="fax" name="fax" placeholder="Fax">
                                                        <label for="fax">Fax <span class="text-danger"></span></label>
                                                    </div>
                                                </div>											
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{phone}" type="tel" id="phone" name="phone" placeholder="Office Phone">
                                                        <label for="phone">Office Phone <span class="text-danger"></span></label>
                                                    </div>
                                                </div>
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{mobile}" type="tel" id="mobile" name="mobile" placeholder="Mobile">
                                                        <label for="mobile">Mobile <span class="text-danger"></span></label>
                                                    </div>
                                                </div>
                                            </div> 
											<div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{postalAddress}" type="text" id="postalAddress" name="postalAddress" placeholder="Postal Address">
                                                        <label for="postalAddress">Postal Address <span class="text-danger"></span></label>
                                                    </div>
                                                </div>
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{city}" type="text" id="city" name="city" placeholder="Please enter your town/city">
                                                        <label for="city">Town/City <span class="text-danger"></span></label>
                                                    </div>
                                                </div>
                                            </div>
											<div class="form-group">                                                
												<div class="col-sm-12">                                                    
													<div class="form-material floating">
														<!--select class="js-select2 form-control" id="country" name="country"  th:field="*{country.id}" style="width: 100%;" data-placeholder="Choose one.."-->
		                                           		<select class="js-select2 form-control" th:field="*{country}" id="country" name="country"  style="width: 100%;" data-placeholder="Choose one..">
		                                           			<option th:each="c:${countries}" th:value="${c.id}" th:text="${c.name}"></option>
		                                           		</select>
		                                           		<label for="country">Country <span class="text-danger"></span></label>
		                                           	</div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- END Step 1 -->

                                        <!-- Step 2 -->
                                        <div class="tab-pane fade fade-right push-30-t push-50" id="validation-step2">
											<div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" type="text" th:field="*{firstname}" id="firstname" name="firstname" placeholder="First Name">
                                                        <label for="firstname">First Name <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" type="text" th:field="*{lastname}" id="lastname" name="lastname" placeholder="Last Name">
                                                        <label for="lastname">Last Name <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
                                            </div>
											<div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{contactPersonPhone}" type="tel" id="contactPersonPhone" name="contactPersonPhone" placeholder="Contact Person Phone">
                                                        <label for="contactPersonPhone">Phone <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{contactPersonAddress}" type="text" id="contactPersonAddress" name="contactPersonAddress" placeholder="Contact Person Address">
                                                        <label for="contactPersonAddress">Address <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
                                            </div>
											<div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{designation}" type="text" id="designation" name="designation" placeholder="Designation">
                                                        <label for="designation">Designation <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>	
												<div class="col-sm-6">
                                                    <label class="css-input switch switch-sm switch-primary" for="isPrimaryDesignator">
                                                        <input type="checkbox" id="isPrimaryDesignator" name="isPrimaryDesignator"><span></span> I Am The Company Primary Designator?
                                                    </label>
                                                </div>											
                                            </div>
                                        </div>
                                        <!-- END Step 2 -->

                                        <!-- Step 3 -->
                                        <div class="tab-pane fade fade-right push-30-t push-50" id="validation-step3">
											<div class="form-group">
                                                <div class="col-sm-12">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{username}" type="email" id="username" name="username" placeholder="Username (Email)">
                                                        <label for="username">Username(Email) <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" th:field="*{password}" type="password" id="password" name="password" placeholder="Password">
                                                        <label for="password">Password <span class="text-danger">*</span></label>
														<div class="input-group push-10"> 
								                            <div class="progress col-sm-12"> 
								                                <div class="progress-bar col-sm-12 push-10" 
								                                     role="progressbar" 
								                                     aria-valuenow="0" 
								                                     aria-valuemin="0" 
								                                     aria-valuemax="100" 
								                                     style="width:0%"> 
								                                </div> 
								                            </div> 
								                        </div> 
                                                    </div>
                                                </div>
												<div class="col-sm-6">
                                                    <div class="form-material">
                                                        <input class="form-control" type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm password">
                                                        <label for="confirmPassword">Confirm Password <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <div class="col-sm-8 col-sm-offset-2">
                                                    <label class="css-input switch switch-sm switch-primary" for="terms">
                                                        <input type="checkbox" id="terms" name="terms"><span></span> I Agree with the <a data-toggle="modal" data-target="#modal-terms" href="#">terms</a>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- END Step 3 -->
                                    </div>
                                    <!-- END Steps Content -->

                                    <!-- Steps Navigation -->
                                    <div class="block-content block-content-mini block-content-full border-t">
                                        <div class="row">
                                            <div class="col-xs-6">
                                                <button class="wizard-prev btn btn-warning" type="button"><i class="fa fa-arrow-circle-o-left"></i> Previous</button>
                                            </div>
                                            <div class="col-xs-6 text-right">
                                                <button class="wizard-next btn btn-success" type="button">Next <i class="fa fa-arrow-circle-o-right"></i></button>
                                                <button class="wizard-finish btn btn-primary" type="submit"><i class="fa fa-check-circle-o"></i> Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END Steps Navigation -->
                                </form>
                                <!-- END Form -->
                            </div>
                            <!-- END Validation Wizard Wizard -->
                        </div>
						<div class="col-lg-2">&nbsp;</div>
                    </div>
                    <!-- END Wizards with Validation -->
                </div>
                <!-- END Page Content -->
            </main>
            <!-- END Main Container -->

			<!--div id="wait" style="display:none;width:69px;height:89px;border:0px solid black;position:absolute;
	          	top:50%;left:50%;padding:2px;">
	          	<img src="../assets/images/loader.gif" width="64" height="64" />                   	
	          	<br>Working...
          	</div-->
			
            <!-- Footer -->
            <div th:replace="fragments/footer::content"></div>
            <!-- END Footer -->
			<!-- Terms & Conditions -->
			<div th:replace="fragments/modal-terms::content"></div>
			<!-- End Terms & Conditions -->
        </div>
        <!-- END Page Container -->		 
        
        <!-- OneUI Core JS: jQuery, Bootstrap, slimScroll, scrollLock, Appear, CountTo, Placeholder, Cookie and App.js -->
        <script src="../assets/js/core/jquery.min.js"></script>
        <script src="../assets/js/core/bootstrap.min.js"></script>
        <script src="../assets/js/core/jquery.slimscroll.min.js"></script>
        <script src="../assets/js/core/jquery.scrollLock.min.js"></script>
        <script src="../assets/js/core/jquery.appear.min.js"></script>
        <script src="../assets/js/core/jquery.countTo.min.js"></script>
        <script src="../assets/js/core/jquery.placeholder.min.js"></script>
        <script src="../assets/js/core/js.cookie.min.js"></script>
        <script src="../assets/js/app.js"></script>

        <!-- Page JS Plugins -->
        <script src="../assets/js/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>
        <script src="../assets/js/plugins/jquery-validation/jquery.validate.min.js"></script>

        <!-- Form Wizard JS Code -->
        <script src="../assets/js/pages/base_forms_wizard.js"></script>  
		
		<script src="../assets/js/plugins/select2/select2.full.min.js"></script>
         <!-- Dropdown JS Code -->
        <script>
            $(function () {
                // Init page helpers (BS Datepicker + BS Colorpicker + Select2 + Masked Input + Tags Inputs plugins)
                App.initHelpers(['select2']);
            });
        </script>    
		<!-- Start Ajax functionality -->
		<script type="text/javascript">
			/*<![CDATA[*/
			$(document).ready(function()
			{
				var bridgeUrl = '[[${bridgeURL}]]';
				console.log(bridgeUrl);
				$(".wizard-next").attr("disabled", false);//disable next button if enabled
				$(".wizard-finish").attr("disabled", true);//disable submit button if disabled
				//
				$("#name").blur(function(){
					searchVendorName(bridgeUrl);
				});	
				//
				$("#contractNo").blur(function(){
					searchContractNo(bridgeUrl);
				});		
				// Update progress bar as per the input 
				// Whenever the key is pressed, apply condition checks.  
	            $("#password").keyup(function() { 
	                var m = $(this).val(); 
	                var n = m.length; 
					
	                // Function for checking 
	                check(n, m); 
	            }); 
			});
			
			function searchVendorName(bridgeUrl)
			{
				var search = {};
				search['name'] = $("#name").val().trim();
				$("#wait").css("display", "block");
        		$("#alert1").css("display", "none");
        		//
        		var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
            	//
				//console.log(JSON.stringify(search));
				$.ajax({
        			type : 'POST',
					url: bridgeUrl + "/suppliers/partial",
        			headers: {"X-CSRF-TOKEN": token}, //send CSRF token in header
                    dataType : 'json',
					data: JSON.stringify(search),
                    contentType: 'application/json',
        	        success	: function (results){
        	        	console.log('Supplier name match = ' + JSON.stringify(results));
						const res =  JSON.stringify(results) ;
						const myObj = JSON.parse(res);
						console.log('ECSRM ID: ' + myObj.ecsrmId);
        	        	if(parseFloat(myObj.jwSimilarity)>=89.0)
        	        	{
							console.log("Supplier name match meets the required threshold!");
							$("#ecsrmId").val(myObj.ecsrmId);
							$("#name").val(myObj.name);
							$("#code").val(myObj.code);
							$(".wizard-next").attr("disabled", false);//enable next button if disabled
           					
        	        	}else{
							console.log("Supplier name match does not meet the required threshold!");
							$("#ecsrmId").val("");//clear ecsrm id in case it had any values
							$("#code").val("");//clear supplier code in case it had any values
							$(".wizard-next").attr("disabled", true);//disable next button if enabled
        	        		$("#alert1").css("display", "block");
        	        		$("#alert1").text('Error processing your request, Please try again!');
        	        	}       					
        				//hide gif
        				$("#wait").css("display", "none");
        	        },
        	        error:	function (e){
						$("#ecsrmId").val("");
						$("#code").val("");
						$(".wizard-next").attr("disabled", true);//disable next button if enabled
        	        	console.log(e);
        	        	$("#wait").css("display", "none");
        	        	$("#alert1").css("display", "block");
        	        	$("#alert1").text('An error was encountered while processing your request, Please try again!');
        	        }
        		});				
			}
			//
			function searchContractNo(bridgeUrl)
			{
				var search = {};
				search['contractNo'] = $("#contractNo").val().trim();
				search['supplierId'] = $("#ecsrmId").val().trim();
				$("#wait").css("display", "block");
        		$("#alert1").css("display", "none");
        		//
        		var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
            	//
				console.log('contract search..' + JSON.stringify(search));
				$.ajax({
        			type : 'POST',
					url:  bridgeUrl + "/contracts/supplier",
        			headers: {"X-CSRF-TOKEN": token}, //send CSRF token in header
                    dataType : 'json',
					data: JSON.stringify(search),
                    contentType: 'application/json',
        	        success	: function (results){
        	        	console.log('Supplier contract = ' + JSON.stringify(results));
						const res = JSON.stringify(results);
						const obj = JSON.parse(res);
						console.log("Contract Number - " + obj.contractNo);
        	        	if(obj.contractNo==$("#contractNo").val().trim())
        	        	{
							$(".wizard-next").attr("disabled", false);//enable next button if disabled
           					
        	        	}else{
							$(".wizard-next").attr("disabled", true);//disable next button if enabled
        	        		$("#alert1").css("display", "block");
        	        		$("#alert1").text('We are unable to proceed with your request, Please try again later!');
        	        	}       					
        				//hide gif
        				$("#wait").css("display", "none");
        	        },
        	        error:	function (e){
						$(".wizard-next").attr("disabled", true);//disable next button if enabled
        	        	console.log(e.responseText);
        	        	$("#wait").css("display", "none");
        	        	$("#alert1").css("display", "block");
        	        	$("#alert1").text(e.responseText);
        	        }
        		});				
			}
					
		 //End Ajax functionality -->
		 //Start Password strength progress bar  -->
					
	        var percentage = 0; 
	  
	        function check(n, m) 
			{ 
	            if (n < 6) { 
	                percentage = 0; 
	                $(".progress-bar").css("background", "#dd4b39"); 
	            } else if (n < 8) { 
	                percentage = 20; 
	                $(".progress-bar").css("background", "#9c27b0"); 
	            } else if (n < 10) { 
	                percentage = 40; 
	                $(".progress-bar").css("background", "#ff9800"); 
	            } else { 
	                percentage = 60; 
	                $(".progress-bar").css("background", "#4caf50"); 
					$(".wizard-finish").attr("disabled", false);//enable submit button if disabled
	            } 
	  
	            // Check for the character-set constraints 
	            // and update percentage variable as needed. 
	            
	            //Lowercase Words only 
	            if ((m.match(/[a-z]/) != null))  
	            { 
	                percentage += 10; 
	            } 
	            
	            //Uppercase Words only 
	            if ((m.match(/[A-Z]/) != null))  
	            { 
	                percentage += 10; 
	            } 
	            
	            //Digits only 
	            if ((m.match(/0|1|2|3|4|5|6|7|8|9/) != null))  
	            { 
	                percentage += 10; 
	            } 
	            
	            //Special characters 
	            if ((m.match(/\W/) != null) && (m.match(/\D/) != null)) 
	            { 
	                percentage += 10; 
	            } 
	  
	            // Update the width of the progress bar 
	            $(".progress-bar").css("width", percentage + "%"); 
	        } 
	  
	        
	         
			/*]]>*/
	    </script>
		<!--  End Password strength progress bar  -->
    </body>
</html>